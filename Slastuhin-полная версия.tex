% Установка размеров страницы
%\textheight = 478pt \textwidth=4.5in \topmargin=0.75in \headsep=0.25in
%\topskip=10pt \footskip=0.35in
%%%% В случае использования LaTEX 2.e %%%%%%
\documentclass[14pt, a4paper]{extbook}
\usepackage{amsfonts}
\usepackage[cp1251]{inputenc} %кодировка должна быть такой
\usepackage[T2A]{fontenc}
\usepackage{mathtext}
\usepackage{amsmath, amsfonts, amssymb}
\usepackage[english, russian]{babel}
\usepackage[body={6.6in, 9.2in},left=1in, top=1.2in]{geometry}
\usepackage{indentfirst}
\usepackage[]{graphicx}
\usepackage{floatflt}
\usepackage{amsthm}


\begin{document}
	{\sl УДК~517.9} % Номер УДК
	\medskip
	
	\begin{center}
		{\bf А.Ю.~Сластухин}\\[0.2cm] %% Автор
		{\Large Снифферы и их применения в задачах перехвата сетевого трафика} % Название
	\end{center}
	\begin{center}%в этой шапке (заголовке) надо вставить данные. Оформление менять НЕ надо.
		\textbf{\large Снифферы и их применения в задачах перехвата сетевого трафика} %название работы
		
		\textit{\textbf{Сластухин А.~Ю. (ЯрГУ им. П.~Г.~Демидова, Ярославль)}} %Фамилия И.О. автора1 (ВУЗ, Город)
		
		\textit{Научный руководитель: , Старший преподаватель  Савинов~Д.~А.} %степень, звание (которое присудила ВАК) Фамилия И.О. научного руководителя
	\end{center}
	
	\begin{center}
		{\small \bf Задача}
	\end{center}
	Рассказать о снифферах, как о инструментах анализа сетевого трафика, применяемого с целью реверс инжиниринга систем, ведения шпионажа и борьбы с ним.
	
	\begin{center}
		{\small \bf Снифферы}
	\end{center}
	Это программы или аппаратные решения, способные перехватывать и анализировать сетевой трафик, проходящий через устройство.
	
	Снифферы отличаются следующими особенностями:
	\begin{enumerate}
		\item
		Поддерживаемые сетевые протоколы
		\item
		Качество декодирования протоколов
		\item
		Наличие пользовательского интерфейса
		\item
		Доступ к статистике сетевых запросов
		\item 
		Возможность просмотра трафика в реальном времени
	\end{enumerate}
	
		Начнём своё знакомство со встроенных в браузеры анализаторов сети.
	Их преимущество заключается в том, что их не нужно устанавливать отдельно, можно использовать хоть сегодня вечером, читая статью на любимом форуме.
	
	{\small \bf Встроенные средства браузера}
	
	Опишу на примере браузера Google Chrome version 118.0.5993.89. В других браузерах различия будут незначительны. Если разберётесь с одним из них, другие проблемой не станут. Я ещё не встречал современных браузеров, которые бы не поддерживали просмотр запросов.
	
		Анализатор сети браузера отлавливает все отправленные и полученные запросы, фильтрует их и выводит те, которые относятся к хосту.	
	Использование даже встроенных анализаторов позволяет нам заниматься ревирс инжинирингом сайта, мы можем отследить, как клиентская сторона (наш браузер) взаимодействует с сервером.
	Заходим на любой сайт и открываем средства разработчика – F12.
	Переходим в параметры сети – Network.
	Выполним любое действие на сайте, например, пройдём авторизацию или применим фильтры.
	Возвращаемся на вкладку Network и видим, что появилась информация о запросах:
		\begin{enumerate}
		\item
		Тип запроса(Get, Post и т.д.)
		\item
		Адрес(какому API обращается клиент)
		\item
		Тело запроса(если оно есть)
		\item
		Заголовки(Headers)
		\item 
		Cookie
	\end{enumerate}
	
	{\small \bf FingerPrint браузера}	
	- это информация, собранная о удалённом устройстве с целью анализа и дальнейшего использования.
	
	Вернёмся к средствам анализа сети.
	\begin{enumerate}
	\item
	Обратите внимание на заголовки, помимо служебной информации, тут вы найдёте данные о клиенте, такие как версия браузера, размер окна и тд. Данная информация(они часть FingerPrint-а) зачастую нужна для сбора статистики по пользователям, для выявления целевой аудитории - так, например, можно понять, на каких конфигурациях стоит тщательнее тестировать продукт. 
	\item
	Но эта же информация может быть использована в качестве отпечатка вашего компьютера, с помощью которой можно будет идентифицировать отправителя.
	\item
	Помимо этого, на стороне сервера можно попытаться отсеять часть запросов, отправленных не людьми, например: можно посмотреть на состав заголовков, на переданные значения - может получиться так, что такой запрос не может быть сформирован клиентским приложением - значит, вероятно, это кто-то со стороны(бот, спамер, парсер), но это скорее проверка на дурака, чем 100\% решение проблемы парсинга(когда к сайту отправляет запросы не человек, сайт возращает ответ, из полученных данных извлекается информация с помощью, например, xPath, Regex).
	\end{enumerate}
	
	Мы увидели структуру запроса, на который сервер нам вернул страницу, попробуем исполнить запрос самостоятельно через такое средство, как Postman(или любое расширение, встроенное в браузер,например, Postman Interceptor)
	
	{\small \bf Postman}
	- это инструмент, позволяющий формировать запросы и отправлять их. Активно используется в тестировании API.
	
	Формируя и отправляя запрос, мы сможем понять, какие заголовки критичны для получения ответа от сервера (это уникальный момент для каждого API, зависит от программиста, писавшего его).
	Когда нам удалось построить валидный запрос, можем перенести его формирование в своё приложение, которое будет обрабатывать ответы сервера, агрегировать нужную нам информацию.
	
	Многие сервисы отвлеживают запросы, которые отличаются от запросов браузера(запросов целевого пользователя).	
		
	Обратите внимание, что политика использования сервиса может быть разной, кто-то не станет вам мешать, но кто-то накажет.
	
	Рассмотрим две ситуации:	
	\begin{enumerate}
	\item
	Сервис вернул статус ошибки и тогда тот, кто пытается использовать его, сможет перестроить запрос и повторить попытку - такое применяется в случае, когда разработчик не против того, чтобы его сервис использовали.
	
	\item
	Сервис получает нужный запрос, но сигнатура запроса не та(например, нет нужных заголовков для FingerPrint) и помечает отправителя как потенциального бота и отдаёт ему валидный ответ, отслеживает устройства, приславшие такой же по сигнатуре запрос(с той же ошибочной структурой), потом банит всех под предлогом атаки на сервис - оцените сами, как найти всех таких "злоумышленников"? Дать им поверить, что они используют структуру, не отличающуюся от запроса обычного клиента, подождать, тк обычно сначала идут тестовые попытки отправить запрос и получить валидный ответ, а потом начинается использование с нескольких устройств - по ошибочной сигнатуре мы можем легко найти всех и забанить - так часто действуют на площадках, не готовых делиться информацией. Не стоит этим пренебрегать, мы как-то потеряли таким образом все свои Ip для отправки запросов.
	\end{enumerate}
		
	{\small \bf Снифферы}
	
	Мы рассмотрели примитивный пример на основе анализа трафика в браузере, но это далеко не всё. Существуют утилиты(снифферы), позволяющие ослеживать весь сетевой трафик, проходящий через наше устройство(запросы браузера, вход в любимые игры, запрос обновления - всё, что использует сеть для своей работы).
	
	Например:
	\begin{enumerate}
	\item Fiddler 4 - удобная, но платная. Есть бесплатные версии со сторонних сайтов, но существует риск - опасно ставить непровернное ПО такого уровня, требуются повышенные права.
	\item WireShark - популярная утилита, имеет массу возможностей, гайдов, стоит рассмотреть к использованию.
	\item Burp suite - ПО для тестирования веб-приложений на проникновение. Можно использовать как для защиты, так и для атаки. На официальном сайте доступен широкий курс обучения обеспечению информационной безопасности.
	\end{enumerate}	
	
	Используя снифферы, можно перехватывать и анализировать свой трафик, искать уязвимости в существующих сервисах - поверьте, периодически попадаются сервисы, имеющие небезопасную архитектуру или неподходящую политику безопасности.
	
	Пример(политика безопасности) из личной практики: существует европейский сервис, поставляющий по платной подписке данные о курсах различных мировых валют(скорее всего люди получают данные по закрытому каналу напрямую из банка). Но на своём сайте, они выводят графики курсов валют даже неавторизованному пользователю. Заметив это и проанализировав уходящий запрос и приходящий ответ, удалось выявить уязвимость(сервер на клиент присылал точки графика, а не сам график), которая позволила выгрузить бесплатно информацию о курсах за последние 10 лет, потратив на это чуть более 100 сетевых запросов, тк сервер возращал все данные по конкретному курсу, не отфильтровав по запросу, фильтрацию производили скрипты на клиенте. 
	
	Помимо этого, похоже, что неавторизованные клиенты отправляли запросы к API с одним авторизационным токеном, который обновлялся, примерно, раз в сутки. Это мешает отследить число запросов неавторизованного клиента к API, ограничить клиента.
	
	Очевидно, что такого не должно было быть.
	
	Ошибка в том, что неавторизованный пользователь вообще не должен был видеть этот график или хотя бы видеть его версию, которую сформировал сервер и отправил клиенту, но уж никак не давать клиенту исходные данные для построения.	
	
	Другой пример(архитектура): 
	Специалист на свой телефон установил приложение и заметил странную особенность - на форме входа пользователь мог указать, под какими правами его нужно было авторизовать(админ/неадмин) в системе. Поймав и проанилизовав запрос, он увидел, что вместе с логином и паролем клиентское приложение передавало серверу role\_id = 1(обычный пользователь), именно эту роль сервер должен был присвоить авторизованному пользователю. Сделав несколько попыток подменить role\_id, Специалист успешно авторизовался в системе под правами администратора со своим паролем от обычного пользователя. Он сообщил об этом разработчикам системы и дыру зашили в течение суток.
	
	Здесь ошибка архитектурная, клиентское приложение не должено диктовать серверу, под какими правами должен быть авторизован клиент. сервер должен проверить по логину и выдать права в зависимости от привязанной роли.

	Данный пример взят с просторов интернета, его цель показать, что запросы можно отлавливать не только в браузере, но и при авторизации в строннем приложении.
	
	Поймите главное - ошибок в разработке очень много, разработчики не волшебники, а люди, которые порой принимают неудачные решения или забывают заварить 'чёрные ходы', которые были удобны на этапе разработки. Сниффер - это инструмент, который может помочь найти такие ошибки.
	
	\begin{center}
		{\small \bf Антиснифферы}
	\end{center}
	Кто сказал, что снифферы не могут использоваться злоумышленником? Они ведь такие удобные, работают на достаточно низком уровне и имеют доступ ко всей сетевой деятельности жертвы.
	
	Злоумышленник может 
	\begin{enumerate}
	\itemПолучить информацию о посещаемых сайтах
	\itemПрограммах, которые работают на компьютере жертвы и используют сеть
	\itemОтлавливать данные, получаемые и отправляемые пользователем, в частности, логины и пароли, передаваемые в хэшированном виде(даже это очень важная информация, ведь так пароль можно подобрать на каком-нибудь очень мощном оборудовании). Представьте, что ваша переписка тоже может стать частью журнала злоумышленника, полученного с вашего устройства.
	\end{enumerate}
	
	Всё это злоумышленник может использовать в своих интересах. Например, использовать ваши Cookies, которые не на всех сайтах привязаны к Ip адресу(кстати, привязка Ip клиента к выдаваемой ему cookie - идея неплохая).
	
	{\small \bfГде может скрываться угроза?}
	\begin{enumerate}
		\itemНелицензированное ПО или ПО с закрытым исходным кодом (Мы не знаем заранее, что туда встроено)
		\itemДрайвера устройств - лакомый кусочек для закладки туда любого опасного кода (их часто качают, где попало, работают на низком уровне системы, для их установки зачастую требуются повышенные права). Например: логгер клавиатуры, спрятанный в драйвер клавиатуры.
		
		\itemИспользование в рабочих проектах сторонних библиотек с закрытым исходным кодом или без проведения проверок(как и в первом случае, мы не можем гарантировать безопасность их использования)		
	\end{enumerate}
	
	{\small \bfЧто может помочь найти угрозу?}		
	\begin{enumerate}
	\itemСнифферы могут выступать и в роли антиснифферов-контролируя трафик, они могут выявлять активность вредоносного ПО - одна из базовый мер противодействия таким угрозам. 
	В качестве сниффера, который может выполнять роль антисниффера, предлагаю рассмотреть Wareshark{[1]}.
	
	\item Jenkins - программная система с открытым исходным кодом на Java, предназначенная для обеспечения процесса непрерывной интеграции программного обеспечения, которая так же содержит инструменты для выявления уязвимостей в используемых библиотеках и написанном коде.
	\end{enumerate}
	
	{\small \bfКосвенные признаки наличия угрозы}
	
	Если ваша система не находит уязвимостей, антисниффер показывает, что всё в порядке - это не показывает, что всё хорошо, вас всё ещё могут слушать, рассмотрим несколько признаков, которые подскажут, что что-то может быть не в порядке:
	
	\begin{enumerate}
		\item Система стала тормозить - вероятно, что что-то потребляет её ресурсы для работы в вашей системе.
		\item Соединение с интернетом переключается с более высокого уровня на более низкий и обратно. Например, для перехвата ваших данных спец службам не нужно ставить дополнительное программное обеспечение на ваше устройство, можно перенаправить ваш трафик через сетевой узел, который будет читаться "Большим братом" и вы об этом не узнаете. Скорее всего, из-за подключения к прослушке трафика происходит такой скачок соединения. 
		\item Вырастает энергопотребление(на аккумуляторных устройствах это заметнее - разряжаются в несколько раз быстрее) - тк устройство переключается к режим отдачи  информации с большей частотой, чем обычно. Это может быть как встроенный в устройство механизм, который заложен производителем для возможной слежки за клиентами, так и программное дополнение к вашей системе, которое было занесено в систему из вне.
	\end{enumerate}
	
	Злоумышленники находят уязвимости в наших системах,поступая творчески, поэтому нам для борьбы с угрозами нельзя опираться только на ПО, которое магическим образом отловит весь вредоносный трафик в нашей сети - такого не бывает. Существуют угрозы, которые до сих пор не всегда отлавливаются антиснифферами, их можно обнаружить, только просматривая трафик самостоятельно. 
	
	Примером такой угрозы может служить BPFDoor-Berkley Packet Filter{[2]}, которая была обнаружена исследователями Deep Instinct. Deep Instinct отмечает, что на момент анализа новая версия BPFDoor не определялась как вредоносная ни одним из доступных антивирусных движков на VirusTotal, хотя впервые она появилась на платформе еще в феврале 2023 года.
	
	\begin{center}
		{\small \bf Заключение}
	\end{center}
	Сниффер - полезный инструмент, который может использоваться как для ревирс инженеринга построенных систем с целью выявления уязвимостей, так и для шпионажа(анализатор трафика выступает в качестве вредоносного ПО на устройстве жертвы), для борьбы с ним.
	
	Помните, что сниффер это лишь инструмент, который мы можем использовать в работе, но нам не стоит палагаться на него в полной мере - нужно подходить творчески и подобно злоумышленникам находить уязвимости там, где их, кажется, нет.
	
	Если захотите подготовить на основе этой статью доклад, можете воспользоваться презентацией, которую я опубликовал вместе с текстом в GitHub репозиторий[3].	
	
	%%Текст статьи
	

	
	%%Список литературы
	\bigskip
	{\large\bf Литература}
	
	\begin{enumerate}
		\item
		https://telegra.ph/Wireshark---uchimsya-skanirovat-set-04-01
		\item
		https://xakep.ru/2023/05/15/new-bpfdoor
		\item
		https://github.com/SkibaSAY/Doclad\_Sniffers
	\end{enumerate}
	
	\begin{flushright}
		{\it Ярославский государственный университет им. П.Г. Демидова}
	\end{flushright}
	
\end{document}